<!-- Profile Dashboard -->
<div class="profile-dashboard">
  <!-- Header -->
  <div class="profile-header fade-in-up">
    <h1 class="profile-title slide-in-left">Profile</h1>
    <button class="add-employee-btn slide-in-right" *ngIf="currentUser()?.role === 'admin'">
      <i class="fas fa-plus"></i>
      Add Employee
    </button>
  </div>

  <!-- Navigation Tabs -->
  <div class="profile-tabs fade-in-up">
    @for (tab of getVisibleTabs(); track tab.id) {
      <button 
        (click)="setActiveTab(tab.id)"
        class="tab-button animated-tab"
        [class.active]="tab.active">
        <i [class]="tab.icon"></i>
        {{ tab.label }}
      </button>
    }
  </div>

  <!-- Main Content -->
  <div class="profile-content">
    <!-- Left Column - Profile Card -->
    <div class="profile-sidebar fade-in-left">
      <!-- Profile Card -->
      <div class="profile-card animated-card">
        <div class="profile-avatar-container animated-avatar">
          <div class="profile-avatar hover-lift" (click)="triggerFileUpload()">
            <img 
              *ngIf="getProfileImageUrl()" 
              [src]="imageService.getOptimizedProfileImageUrl(getProfileImageUrl()!, 'medium')" 
              alt="Profile Picture"
              class="avatar-image">
            <div 
              *ngIf="!getProfileImageUrl()" 
              class="avatar-initials">
              {{ getUserInitials(currentUser()!) }}
            </div>
            <div class="avatar-overlay">
              <i class="fas fa-camera"></i>
              <span>Edit Photo</span>
            </div>
            <input
              type="file"
              (change)="onFileSelected($event)"
              accept="image/png, image/jpeg, image/gif"
              class="hidden">
          </div>
        </div>
        
        <div class="profile-info">
          <h2 class="profile-name">{{ currentUser()?.name }}</h2>
          <p class="profile-id">#{{ currentUser()?.id?.slice(-8)?.toUpperCase() }}</p>
        </div>
      </div>

      <!-- About Section -->
      <div class="info-section animated-section">
        <h3 class="section-title">About</h3>
        <div class="info-item animated-item">
          <i class="fas fa-envelope info-icon"></i>
          <span>{{ currentUser()?.email }}</span>
        </div>
        <div class="info-item animated-item" *ngIf="currentUser()?.phone">
          <i class="fas fa-phone info-icon"></i>
          <span>{{ currentUser()?.phone }}</span>
        </div>
        <div class="info-item animated-item" *ngIf="currentUser()?.bio">
          <i class="fas fa-user-circle info-icon"></i>
          <span>{{ currentUser()?.bio }}</span>
        </div>
      </div>

      <!-- Address Section -->
      <div class="info-section animated-section">
        <h3 class="section-title">Address</h3>
        <div class="info-item animated-item">
          <i class="fas fa-map-marker-alt info-icon"></i>
          <span>{{ getUserAddress() }}</span>
        </div>
        <div class="info-item animated-item">
          <i class="fas fa-city info-icon"></i>
          <span>{{ getUserCity() }}</span>
        </div>
        <div class="info-item animated-item">
          <i class="fas fa-mail-bulk info-icon"></i>
          <span>{{ getUserPostalCode() }}</span>
        </div>
      </div>

      <!-- User Details Section -->
      <div class="info-section animated-section">
        <h3 class="section-title">User Details</h3>
        <div class="info-item">
          <i class="fas fa-calendar-alt info-icon"></i>
          <span>Joined {{ getJoinDate() }}</span>
        </div>
        <div class="info-item">
          <i class="fas fa-id-card info-icon"></i>
          <span>{{ currentUser()?.role | titlecase }}</span>
        </div>
        <div class="info-item">
          <i class="fas fa-shield-alt info-icon"></i>
          <span>{{ currentUser()?.isVerified ? 'Verified User' : 'Unverified User' }}</span>
        </div>
      </div>
    </div>

    <!-- Right Column - Tab Content -->
    <div class="profile-main fade-in-right">
      <!-- Overview Tab -->
      <div *ngIf="activeTab() === 'overview'" class="tab-content animated-content fade-in-up">
        <!-- Business Information (only for business/admin users) -->
        <div class="content-panel animated-panel" *ngIf="currentUser()?.role === 'business' || currentUser()?.role === 'admin'">
          <div class="panel-header">
            <h3 class="panel-title">Business Information</h3>
            <button class="add-info-btn hover-lift">+ Add Info</button>
          </div>
          <div class="business-table">
            <div class="table-header">
              <div class="table-cell">BUSINESS</div>
              <div class="table-cell">CATEGORY</div>
              <div class="table-cell">TRUST SCORE</div>
              <div class="table-cell">STATUS</div>
              <div class="table-cell">ACTIONS</div>
            </div>
            @for (business of mockData.businesses; track business.name) {
              <div class="table-row animated-row">
              <div class="table-cell">{{ business.name }}</div>
              <div class="table-cell">{{ business.category }}</div>
              <div class="table-cell">{{ business.trustScore }}%</div>
              <div class="table-cell">
                <span class="status-badge" [class.verified]="business.status === 'Verified'">
                  {{ business.status }}
                </span>
              </div>
              <div class="table-cell">
                <i class="fas fa-ellipsis-v"></i>
              </div>
              </div>
            }
          </div>
        </div>

        <!-- Activity Panel -->
        <div class="content-panel">
          <div class="panel-header">
            <h3 class="panel-title">Activity</h3>
          </div>
          <div class="activity-list">
            @for (activity of mockData.recentActivity; track activity.action) {
              <div class="activity-item">
                <div class="activity-avatar">
                  <img [src]="getProfileImageUrl()" alt="User" *ngIf="getProfileImageUrl()">
                </div>
                <div class="activity-content">
                  <p class="activity-text">{{ activity.action }} for <strong>{{ activity.business }}</strong></p>
                  <p class="activity-date">{{ activity.date }}</p>
                </div>
              </div>
            }
          </div>
          <a href="#" class="view-all-link">View all</a>
        </div>

        <!-- Trust Score Panel -->
        <div class="content-panel">
          <div class="panel-header">
            <h3 class="panel-title">Trust Score</h3>
          </div>
          <div class="trust-score-content">
            <div class="score-item">
              <span class="score-value">{{ mockData.trustScore }}%</span>
              <span class="score-label">Overall Trust Score</span>
            </div>
            <div class="score-item">
              <span class="score-value">{{ mockData.reputation }}/5</span>
              <span class="score-label">Average Rating</span>
            </div>
            <div class="score-item">
              <span class="score-value">{{ mockData.reviewsCount }}</span>
              <span class="score-label">Reviews Posted</span>
            </div>
          </div>
          <a href="#" class="view-all-link">View all</a>
        </div>
      </div>

      <!-- Business Info Tab -->
      <div *ngIf="activeTab() === 'business'" class="tab-content animated-content fade-in-up">
        <div class="content-panel">
          <h3 class="panel-title">Business Information</h3>
          <p class="panel-description">Manage your business profiles and verification status.</p>
          <!-- Business info content will go here -->
        </div>
      </div>

      <!-- Reviews Tab -->
      <div *ngIf="activeTab() === 'reviews'" class="tab-content animated-content fade-in-up">
        <div class="content-panel">
          <h3 class="panel-title">Your Reviews</h3>
          <p class="panel-description">View and manage your business reviews.</p>
          <!-- Reviews content will go here -->
        </div>
      </div>

      <!-- Trust Score Tab -->
      <div *ngIf="activeTab() === 'trust'" class="tab-content animated-content fade-in-up">
        <div class="content-panel">
          <h3 class="panel-title">Trust Score Details</h3>
          <p class="panel-description">Detailed breakdown of your trust score and reputation.</p>
          <!-- Trust score content will go here -->
        </div>
      </div>

      <!-- Settings Tab -->
      <div *ngIf="activeTab() === 'settings'" class="tab-content animated-content fade-in-up">
        <div class="content-panel">
          <h3 class="panel-title">Account Settings</h3>
          <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="settings-form">
            <!-- Two-column layout for name and contact fields -->
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">First Name</label>
                <input
                  formControlName="firstName"
                  type="text"
                  class="form-input"
                  placeholder="Enter first name">
                <div *ngIf="getFieldError('firstName')" class="form-error">
                  {{ getFieldError('firstName') }}
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Last Name</label>
                <input
                  formControlName="lastName"
                  type="text"
                  class="form-input"
                  placeholder="Enter last name">
                <div *ngIf="getFieldError('lastName')" class="form-error">
                  {{ getFieldError('lastName') }}
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Email Address</label>
                <input
                  formControlName="email"
                  type="email"
                  class="form-input"
                  placeholder="Enter email address"
                  readonly>
                <div *ngIf="getFieldError('email')" class="form-error">
                  {{ getFieldError('email') }}
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Phone Number</label>
                <input
                  formControlName="phone"
                  type="tel"
                  class="form-input"
                  placeholder="Enter phone number">
                <div *ngIf="getFieldError('phone')" class="form-error">
                  {{ getFieldError('phone') }}
                </div>
              </div>
            </div>

            <!-- Full-width bio field -->
            <div class="form-group">
              <label class="form-label">Bio</label>
              <textarea
                formControlName="bio"
                class="form-textarea"
                placeholder="Tell us about yourself"
                rows="4"></textarea>
              <div *ngIf="getFieldError('bio')" class="form-error">
                {{ getFieldError('bio') }}
              </div>
            </div>

            <button
              type="submit"
              [disabled]="isLoading()"
              class="save-btn">
              <div *ngIf="isLoading()" class="btn-loading">
                <div class="spinner"></div>
                Saving...
              </div>
              <div *ngIf="!isLoading()" class="btn-content">
                <i class="fas fa-save"></i>
                Save Changes
              </div>
            </button>
          </form>
        </div>

        <!-- General Settings -->
        <div class="content-panel">
          <h3 class="panel-title">General Settings</h3>
          <div class="settings-list">
            <!-- Theme Toggle -->
            <div class="setting-item">
              <div class="setting-info">
                <h4 class="setting-title">Theme</h4>
                <p class="setting-description">Choose your preferred theme</p>
              </div>
              <div class="setting-control">
                <div class="theme-toggle">
                  <button 
                    (click)="setTheme('light')"
                    [class.active]="currentTheme() === 'light'"
                    class="theme-btn light-theme">
                    <i class="fas fa-sun"></i>
                    Light
                  </button>
                  <button 
                    (click)="setTheme('dark')"
                    [class.active]="currentTheme() === 'dark'"
                    class="theme-btn dark-theme">
                    <i class="fas fa-moon"></i>
                    Dark
                  </button>
                </div>
              </div>
            </div>

            <!-- Email Notifications -->
            <div class="setting-item">
              <div class="setting-info">
                <h4 class="setting-title">Email Notifications</h4>
                <p class="setting-description">Receive notifications via email</p>
              </div>
              <div class="setting-control">
                <label class="toggle-switch">
                  <input 
                    type="checkbox" 
                    [checked]="emailNotifications()"
                    (change)="toggleEmailNotifications($event)">
                  <span class="slider"></span>
                </label>
              </div>
            </div>

            <!-- Push Notifications -->
            <div class="setting-item">
              <div class="setting-info">
                <h4 class="setting-title">Push Notifications</h4>
                <p class="setting-description">Receive browser push notifications</p>
              </div>
              <div class="setting-control">
                <label class="toggle-switch">
                  <input 
                    type="checkbox" 
                    [checked]="pushNotifications()"
                    (change)="togglePushNotifications($event)">
                  <span class="slider"></span>
                </label>
              </div>
            </div>

            <!-- Review Reminders -->
            <div class="setting-item">
              <div class="setting-info">
                <h4 class="setting-title">Review Reminders</h4>
                <p class="setting-description">Get reminded to leave reviews after transactions</p>
              </div>
              <div class="setting-control">
                <label class="toggle-switch">
                  <input 
                    type="checkbox" 
                    [checked]="reviewReminders()"
                    (change)="toggleReviewReminders($event)">
                  <span class="slider"></span>
                </label>
              </div>
            </div>

            <!-- Privacy Settings -->
            <div class="setting-item">
              <div class="setting-info">
                <h4 class="setting-title">Public Profile</h4>
                <p class="setting-description">Make your profile visible to other users</p>
              </div>
              <div class="setting-control">
                <label class="toggle-switch">
                  <input 
                    type="checkbox" 
                    [checked]="publicProfile()"
                    (change)="togglePublicProfile($event)">
                  <span class="slider"></span>
                </label>
              </div>
            </div>

            <!-- Language Selection -->
            <div class="setting-item">
              <div class="setting-info">
                <h4 class="setting-title">Language</h4>
                <p class="setting-description">Choose your preferred language</p>
              </div>
              <div class="setting-control">
                <select class="language-select" [value]="selectedLanguage()" (change)="onLanguageChange($event)">
                  <option value="en">English</option>
                  <option value="sw">Kiswahili</option>
                  <option value="fr">Français</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>